---
title: Ruby agent 8.x to 7.x migration guide
tags:
  - Agents
  - Ruby agent
  - Getting started
redirects:
  - /docs/agents/ruby-agent/getting-started/migration-9x-guide
---

## Summary [#summary]

This guide covers the major changes between the 8.x and 9.x series of the Ruby agent, issues that may be encountered while upgrading, and how to successfully migrate to version 9.x.

The main changes include:

* [Removed all deprecated configuration options](#removed_config)
* [Dropped support for Ruby 2.2 and 2.3](#ruby_2223)
* [Enabled Thread tracing](#thread_tracing)
* [Removed deprecated instrumntation for gems](#removed_gem_instrumentation)
* [Updated API method `set_transaction_name`](#set_transaction_name)
* [Removed deprecated API methods](#removed_api_methods)

See the [milestone for 9.0](https://github.com/newrelic/newrelic-ruby-agent/milestone/28?closed=1) for more information.

## Removed Deprecated Configuration [#removed_config]

  The following configuration options have been removed and will no longer work. Please update all configs to use the replacements listed below. Please see our [configuration documentation](/docs/apm/agents/ruby-agent/configuration/ruby-agent-configuration) for additional details.

  |  Removed                                  | Replacement                               | `newrelic.yml` example                                                              |
  | ----------------------------------------- | ----------------------------------------- | ----------------------------------------------------------------------------------- |
  | `analytics_events.capture_attributes`     | `transaction_events.attributes.enabled`   | `transaction_events.attributes.enabled: false`                                      |
  | `browser_monitoring.capture_attributes`   | `browser_monitoring.attributes.enabled`   | `browser_monitoring.attributes.enabled: false`                                      |
  | `error_collector.capture_attributes`      | `error_collector.attributes.enabled`      | `error_collector.attributes.enabled: false`                                         |
  | `resque.capture_params`                   | `attributes.include`                      | `attributes.include: ['job.resque.args.*']`                                         |
  | `sidekiq.capture_params`                  | `attributes.include`                      | `attributes.include: ['job.sidekiq.args.*']`                                        |
  | `transaction_tracer.capture_attributes`   | `transaction_tracer.attributes.enabled`   | `transaction_tracer.attributes.enabled: false`                                      |
  | `error_collector.ignore_errors`           | `error_collector.ignore_classes`          | `error_collector.ignore_classes: ['ActionController::RoutingError', 'CustomError']` |
  | `analytics_events.enabled`                | `transaction_events.enabled`              | `transaction_events.enabled: false`                                                 |
  | `analytics_events.max_samples_stored`     | `transaction_events.max_samples_stored`   | `transaction_events.max_samples_stored: 1200`                                       |
  | `disable_database_instrumentation`        | `disable_sequel_instrumentation`          | `disable_sequel_instrumentation: true`                                              |
  | `disable_bunny`                           | `instrumentation.bunny`                   | `instrumentation.bunny: disabled`                                                   |
  | `disable_curb`                            | `instrumentation.curb`                    | `instrumentation.curb: disabled`                                                    |
  | `disable_dj`                              | `instrumentation.delayed_job`             | `instrumentation.delayed_job: disabled`                                             |
  | `disable_excon`                           | `instrumentation.excon`                   | `instrumentation.excon: disabled`                                                   |
  | `disable_grape`                           | `instrumentation.grape`                   | `instrumentation.grape: disabled`                                                   |
  | `disable_grape_instrumentation`           | `instrumentation.grape`                   | `instrumentation.grape: disabled`                                                   |
  | `disable_httpclient`                      | `instrumentation.httpclient`              | `instrumentation.httpcient: disabled`                                               |
  | `disable_httprb`                          | `instrumentation.httprb`                  | `instrumentation.httprb: disabled`                                                  |
  | `disable_dalli`                           | `instrumentation.memcache`                | `instrumentation.memcache: disabled`                                                |
  | `disable_dalli_cas_client`                | `instrumentation.memcache`                | `instrumentation.memcache: disabled`                                                |
  | `disable_memcache_client`                 | `instrumentation.memcache-client`         | `instrumentation.memcache-client: disabled`                                         |
  | `disable_memcache_instrumentation`        | `instrumentation.memcache`                | `instrumentation.memcache: disabled`                                                |
  | `disable_memcached`                       | `instrumentation.memcached`               | `instrumentation.memcached: disabled`                                               |
  | `disable_mongo`                           | `instrumentation.mongo`                   | `instrumentation.mongo: disabled`                                                   |
  | `disable_net_http`                        | `instrumentation.net_http`                | `instrumentation.net_http: disabled`                                                |
  | `prepend_net_instrumentation`             | `instrumentation.net_http`                | `instrumentation.net_http: prepend`                                                 |
  | `disable_puma_rack`                       | `instrumentation.puma_rack`               | `instrumentation.puma_rack: disabled`                                               |
  | `disable_puma_rack_urlmap`                | `instrumentation.puma_rack_urlmap`        | `instrumentation.puma_rack_urlmap: disabled`                                        |
  | `disable_rack`                            | `instrumentation.rack`                    | `instrumentation.rack: disabled`                                                    |
  | `disable_rack_urlmap`                     | `instrumentation.rack_urlmap`             | `instrumentation.rack_urlmap: disabled`                                             |
  | `disable_redis`                           | `instrumentation.redis`                   | `instrumentation.redis: disabled`                                                   |
  | `disable_redis_instrumentation`           | `instrumentation.redis`                   | `instrumentation.redis: disabled`                                                   |
  | `disable_resque`                          | `instrumentation.resque`                  | `instrumentation.resque: disabled`                                                  |
  | `disable_sinatra`                         | `instrumentation.sinatra`                 | `instrumentation.sinatra: disabled`                                                 |
  | `disable_rake`                            | `instrumentation.rake`                    | `instrumentation.rake: disabled`                                                    |
  | `disable_rake_instrumentation`            | `instrumentation.rake`                    | `instrumentation.rake: disabled`                                                    |
  | `disable_typhoeus`                        | `instrumentation.typhoeus`                | `instrumentation.typhoeus: disabled`                                                |


## Removed Support for Ruby 2.2 and 2.3 [#ruby_2223]

  Ruby 2.2 and 2.3 are no longer supported by the ruby agent. In order to continue using the latest Ruby Agent version, please update to Ruby 2.4.0 or above.


## Enabled Thread Tracing by Default [#thread_tracing]

  The configuration option `instrumentation.thread.tracing` is now enabled by default. This will allow the agent to properly monitor code that occurs inside of threads. Work being done inside of threads that previously was not being recorded will now be recorded and associated with the transaction the thread was created in.
  If you are currently using custom instrumentation to start a new transaction inside of threads, this may be a breaking change, as it will no longer start a new transaction if one already exists.


## Removed Deprecated Instrumentation [#removed_gem_instrumentation]

  Support for the following gems has been dropped. Metrics and events will no longer be created for these gems:

  * Acts As Solr
  * Authlogic
  * DataMapper
  * Rainbows
  * Sunspot


## Updated API method `set_transaction_name` [#set_transaction_name]

  When the method `NewRelic::Agent.set_transaction_name` is called, it will now always change the name and category of the currently running transaction to what is passed in to the method. This is a change from how it functioned in previous agent versions. Previously, if `set_transaction_name` was called with a new transaction name and a new category that did not match the category that was already assigned to a transaction, neither the new name nor category would be saved to the transaction. 
  If this method is being called in a situation in which it was previously ignored due to cateogry differences, this will now change the name and category of that transaction. 


## Removed API methods [#removed_api_methods]

  The following deprecated API methods have been removed.
  - `NewRelic::Agent.disable_transaction_tracing` - Use `NewRelic::Agent.disable_all_tracing` instead
