---
title: Magento app monitoring integration
tags:
    - New Relic integrations
    - Magento
metaDescription: Monitor your Magento application.
---

import apmMagentoDashboardOverview from 'images/apm_screenshot-full_magento-dashboard-overview.png'

Magento is an open-source e-commerce platform.
Instrument and monitor your Magento application with the New Relic agents named infrastructure agent, PHP agent, MySQL agent, Apache agent, Elasticsearch agent and NRI-flex.

<img
    title="Magento dashboard overview"
    alt="screenshot of Magento dashboard"
    src={apmMagentoDashboardOverview}
/>

<figcaption>
    After setting up our Magento integration, we give you a dashboard for your Magento app metrics.
</figcaption>

Steps to integrate Magento with New Relic:

<Steps>
    <Step>
        ## Install our infrastructure agent(optional)

        Before getting Magento data into New Relic, first install our infrastructure agent, then you will be able to get details about your host.
        * Follow our guided install to instrument your system with the infrastructure agent. Or if you prefer, you can install the infrastructure agent by following the docs.
        * By integrating this infrastructure agent in your system, one can able to 
        know the CPU usage,Memory usage,Storage usage,Disk usage and Network traffic etc.

        </Step>

    <Step>
        ## Install our PHP agent

        Install PHP agent to instrument your Magento application and get Application and Browser related Metrics like AJAX performance,Error Rate,Duration,Core web vitals and Throughput.
        Follow php documentation: https://docs.newrelic.com/docs/apm/agents/php-agent/getting-started/php-agent-compatibility-requirements/ to learn more about.

        From one.newrelic.com:

        1. Click Add data
        2. Click Application monitoring
        3. Click on PHP card
        4. Select an account
        5. Click Begin installation
        6. Click on On host
        7. Copy the command and run it on your terminal

        </Step>
    
    <Step>
        ## Install MySQL agent

        Install MySQL agent to monitor database related metrics like Database Utilization and Connection like Slowest queries and active connections by node.
        Follow MySQL documentation: https://docs.newrelic.com/install/mysql/  

        From one.newrelic.com:

        1. Click Add data
        2. Click Infrastructure & OS
        3. Click on MySQL card
        4. Select an account
        5. Click Begin installation
        6. Copy the command and run it on your terminal

        </Step>
    
    <Step>
        ## Install Apache agent

        Install Apache agent to know more about TCP connections, DNS lookup , HTTPS, SSL, Server and Worker status.
        Follow Apache documentation: https://docs.newrelic.com/docs/infrastructure/host-integrations/host-integrations-list/apache-monitoring-integration/

        From one.newrelic.com:
                    
        1. Click Add data
        2. Click Infrastructure & OS
        3. Click on Apache card
        4. Select an account
        5. Click Begin installation
        6. Copy the command and run it on your terminal

        </Step>
    

    <Step>
        ## Install Elasticsearch 
        
        Install Elasticsearch agent , if one is using Magento version above 2.4, one needs to install an ElasticSearch application and agent to monitor that application.You can monitor metrics like Cluster status and Current shards.
        docs:https://docs.newrelic.com/docs/infrastructure/host-integrations/host-integrations-list/elasticsearch/elasticsearch-integration/
        Reference:https://magentip.com/install-magento-2-4-x-on-ubuntu-with-elasticsearch/

        From one.newrelic.com:
                    
        1. Click Add data
        2. Click Infrastructure & OS
        3. Click on Elasticsearch card
        4. Select an account
        5. Click Begin installation
        6. Copy the command and run it on your terminal

        </Step>
    

    <Step>
        ## Configure Synthetic Monitoring to monitor your Site Availability and downtime related metrics.

        Details of what has to be configured:

        1. Click Add data
        2. Click Simulate traffic
        3. Click on Synthetic monitoring card
        4. Select monitor type i.e, Availability and Page load 
        5. Configure monitor by giving Name, Tags, URL and Period
        6. Select locations 
        7. Save monitor

        </Step>
    

    <Step>
        ## Install AWS 
        
        Install AWS in order to get metrics like Certificates per account, Groups per account, MFA devices per account, Roles per account and Users per account.

        From one.newrelic.com:
            
        1. Click Add data
        2. Click Amazon Web Services
        3. Click on Integrate your AWS account card
        4. Select an account
        5. Select Amazon Web Services you want to monitor with New Relic.
        Here is the reference docs for AWS IAM :https://docs.newrelic.com/docs/infrastructure/amazon-integrations/aws-integrations-list/aws-iam-monitoring-integration/
        </Step>
    

    <Step>
        ## Install and configure NRI-Flex

        Configure nri-flex to capture all the business metrics through your database queries of your Magento application

        Refernce documentation: https://docs.newrelic.com/docs/infrastructure/host-integrations/host-integrations-list/flex-integration-tool-build-your-own-integration/

        <Steps>
    
    <Step>
        ### Create an nri-flex configuration file

        Path of the configuration file: /etc/newrelic-infra/integrations.d/
        Configuration file name: mysql-database-config.yml

    </Step>

    <Step>
        ### Use the below code snippet in the configuration file

        ```
        # NOTE: 'database' is an experimental API at this time
        # ref: https://github.com/newrelic/nri-flex/blob/master/docs/experimental/db.md
        ---
        integrations:
        - name: nri-flex
            # interval: 30s
            config:
            name: MySQLDbFlex
            apis:
                - database: mysql
                # connection string for an rds mysql instance. Be sure to use the writer endpoint here.  /sys is the default database. newrelic:Password is the user:pass.
                db_conn: newrelic:Root!123@tcp(localhost:3306)/magento2 
                logging:
                    open: true
                # custom_attributes: # applies to all queries
                #   host: CustomMagentoMySQL # custom host name atribute
                db_async: true # process queries async
                db_queries:
                    - name: MySQLShowVars
                    run: SHOW VARIABLES;
                    custom_attributes: # can apply additional at a nested level
                        attype: show-vars
                        host: CustomMagentoMySQL
                    - name: MySQLShowStatus
                    run: SHOW STATUS LIKE 'Max%conn%';
                    custom_attributes: # can apply additional at a nested level
                        attype: used-conns
                        host: CustomMagentoMySQL
                    - name: MySQLCustomProcessList
                    run: SELECT * FROM INFORMATION_SCHEMA.PROCESSLIST # grab all processes from MySQL
                    custom_attributes: # can apply additional at a nested level
                        attype: info-schema-query
                        host: CustomMagentoMySQL
                    - name: MYSQLSalesOrderDetails
                    run: SELECT grand_total, shipping_amount, subtotal, total_paid, discount_amount, store_currency_code, created_at, updated_at, customer_is_guest, tax_amount, customer_id, status, entity_id AS 'order_id' FROM sales_order;
                    - name: MySQLSalesOrderCumulative
                    run: SELECT AVG(grand_total) AS 'average_grand_total', SUM(grand_total) AS 'grand_total_sum', SUM(total_item_count) AS 'total_order_item_count' FROM sales_order;
                    custom_attributes: # can apply additional at a nested level
                        attype: blocking-query
                        host: CustomMagentoMySQL
                    - name: MySQLSalesOrderByStatus
                    run: SELECT status AS 'order_status', COUNT(increment_id) AS 'total_orders', (SUM(grand_total)) AS 'total_billed_amount_by_status' FROM sales_order GROUP BY status;
                    - name: MYSQLSalesOrderByCustomerGroup
                    run: SELECT SUM(salesOrder.grand_total) AS 'grand_total_sum_of_all_orders', AVG(salesOrder.grand_total) AS 'grand_total_average_of_all_orders', customerGroup.customer_group_code AS 'customer_group_code' FROM `sales_order` salesOrder JOIN `customer_group` customerGroup ON salesOrder.customer_group_id = customerGroup.customer_group_id GROUP BY salesOrder.customer_group_id;
                    - name: MYSQLSalesOrderByProduct
                    run: SELECT items.order_id AS 'Order ID', items.created_at AS 'Order Created Date', orders.status AS 'Order Status', items.name AS 'productName', items.sku AS ProductSearchcode, orders.total_item_count AS 'Order Quantity', orders.grand_total AS 'Grand Total' FROM sales_order AS orders JOIN sales_order_item AS items ON items.order_id = orders.entity_id;
                    - name: MYSQLSalesOrderByCategory
                    run: SELECT items.name AS Category, AVG(orders.grand_total) AS 'average_order_total'  FROM sales_order AS orders JOIN sales_order_item AS items ON items.order_id = orders.entity_id GROUP BY items.name;
                    - name: MYSQLSalesOrderByRegion
                    run: SELECT soa.country_id, soa.region_id, dcrn.name 'Region Name', so.entity_id AS 'Order ID', so.grand_total FROM sales_order_address soa JOIN directory_country_region_name dcrn JOIN sales_order so WHERE soa.region_id = dcrn.region_id AND so.entity_id = soa.parent_id;
                    - name: MYSQLSalesOrderByCustomer
                    run: SELECT so.customer_id, ce.email, AVG(so.grand_total) AS 'average_grand_total' FROM sales_order so JOIN customer_entity ce ON so.customer_id = ce.entity_id GROUP BY so.customer_id;
                    - name: MYSQLMagentoDetails
                    run: SELECT query_text, num_results FROM `search_query`;
                    - name: MySQLSalesOrderPayment
                    run: SELECT amount_ordered, shipping_amount, method, additional_information FROM sales_order_payment;
                    custom_attributes: # can apply additional at a nested level
                        attype: blocking-query
                        host: CustomMagentoMySQL
                    - name: MySQLSalesOrderPaymentCount
                    run: SELECT count(*) as CountOfOrderByMethod, method as PaymentMethodType FROM `sales_order_payment` group by method;
                    custom_attributes: # can apply additional at a nested level
                        attype: blocking-query
                        host: CustomMagentoMySQL
                    - name: MySQLCustomerEntity
                    run: SELECT email, created_at, is_active FROM customer_entity;
                    - name: MYSQLAbandonedCarts
                    run: SELECT customer_email, items_count AS 'Products', items_qty AS 'Quantity', subtotal, remote_ip, reserved_order_id FROM `quote` WHERE customer_email IS NOT NULL AND reserved_order_id IS NULL AND subtotal != 0.0000;
                    - name: MYSQLCustomerEntityRegisteredUsers
                    run: SELECT count(*) AS 'Registered Accounts' FROM `customer_entity`;
                    - name: MYSQLUnregisteredCustomers
                    run: SELECT customer_email FROM sales_order WHERE customer_is_guest = 1 GROUP BY customer_email;
                    - name: MYSQLSalesOrderByUnregisteredCustomers2
                    run: SELECT COUNT(entity_id) AS 'Total Order Ids', SUM(grand_total) AS 'Grand Total Sum' FROM sales_order WHERE customer_is_guest = 1;
                    - name: MYSQLCustomerEntityActiveUsers
                    run: SELECT count(is_active) AS 'Active Users' FROM `customer_entity` WHERE is_active = 1;
                    - name: MYSQLReturningCustomers
                    run: WITH ctel1 AS (SELECT COUNT(entity_id) AS 'numberOfOrders', customer_email AS 'customerEmail' FROM sales_order GROUP BY customer_email) SELECT count(*) AS 'returningCustomers' FROM ctel1 WHERE numberOfOrders > 1;
                    - name: MYSQLNewCustomers
                    run: SELECT COUNT(DISTINCT email) AS 'newCustomers' FROM customer_entity WHERE MONTH(created_at) >= MONTH(CURRENT_DATE() - INTERVAL 1 MONTH);
                    - name: MYSQLLoginsPerDay
                    run: SELECT DATE(last_visit_at) as 'Date', count(*) as 'Total Logins', count(DISTINCT customer_id) AS 'Number of Customers' FROM `customer_visitor` GROUP BY customer_id, DATE(last_visit_at);
                    - name: MYSQLBestSellersDaily
                    run: SELECT SUM(qty_ordered) as 'QuantityOrdered', product_name FROM sales_bestsellers_aggregated_daily GROUP BY product_id, product_name ORDER BY QuantityOrdered DESC;
                    - name: MYSQLRevenuePerMonthAndYear
                    run: SELECT SUM(grand_total) AS 'TotalRevenue', AVG(grand_total) AS 'AverageRevenue', YEAR(created_at) AS 'Year', MONTH(created_at) AS 'Month' FROM sales_order WHERE status = 'complete' GROUP BY YEAR(created_at), MONTH(created_at);
                    - name: MYSQLMostViewedProductsDaily
                    run: SELECT SUM(views_num) as 'viewCount', product_name FROM report_viewed_product_aggregated_daily GROUP BY product_name ORDER BY viewCount DESC;
                    - name: MYSQLConversionRate
                    run: WITH cte1 AS (SELECT soi.product_id AS 'SalesProductId', soi.name AS 'ProductName', COUNT(soi.order_id) AS 'totalOrders' FROM `sales_order_item` soi group by soi.product_id, soi.name), cte2 AS (SELECT viewed.product_id AS 'productId', COUNT(viewed.product_id) AS 'totalViews' FROM `report_viewed_product_index` viewed group by viewed.product_id) SELECT SalesProductId as 'productID', ProductName, totalViews,totalOrders,totalOrders/totalViews *100 as 'conversionRateInPercent' FROM cte1 JOIN cte2 WHERE cte1.SalesProductId = cte2.ProductId;
                    - name: MYSQLTopTenSalesOrdersByValue
                    run: SELECT entity_id AS 'orderId', total_item_count AS 'orderQuantity', created_at AS 'createdDate', grand_total AS 'grandTotal' FROM sales_order ORDER BY grand_total DESC LIMIT 10;
                    - name: MYSQLOrdersAverage
                    run: SELECT AVG(order_count) AS 'AverageNumberOfOrders', Year AS 'Year' FROM (SELECT YEAR(created_at) AS 'Year', COUNT(DISTINCT order_id) AS order_count FROM sales_order_item GROUP BY MONTH(created_at), YEAR(created_at)) subquery GROUP BY Year;
                    - name: MYSQLProductsTotal
                    run: SELECT count(*) AS 'Total Products' FROM catalog_product_entity_varchar WHERE attribute_id = 73;
                    custom_attributes: # can apply additional at a nested level
                        attype: blocking-query
                        host: CustomMagentoMySQL


            ```

    </Step>

    <Step>
        ### Restart newrelic infrastructure agent

        [Restart newrelic infrastructure agent](https://docs.newrelic.com/docs/infrastructure/install-infrastructure-agent/manage-your-agent/start-stop-restart-infrastructure-agent/) to start sending all the query results to one.newrelic.com

        Example Query:
        Below is the query to check total registered customers on your magento platform
        ```
        SELECT LATEST(`Registered Accounts`) AS ‘Registered Accounts’ FROM MYSQLCustomerEntityRegisteredUsers
        ```


    </Step>
    </Steps>

<Step>
    ## Monitor your applicaton

    To instrument the Magento quickstart and to see metrics and alerts, you can also follow our [Magento Business Insights quickstart page](https://newrelic.com/instant-observability/magento) by clicking on the “Install now” button.

    You can choose our pre-built dashboard template of “Magento Business Insights” to monitor your Magento application metrics.

    Steps to using a pre-built dashboard template
    Click on Add data
    Click on the Dashboards tab
    In the search box, type Magento
    You should see our pre-build dashboard named “Magento Business Insights”
    Click on it to install it on your account
        </Step>

</Steps>